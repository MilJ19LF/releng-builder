# Lithium build jobs

- project:
    name: autorelease-lithium
    jobs:
        - 'autorelease-daily-lithium'
        - 'autorelease-release-lithium'

    branch: 'stable/lithium'
    project: 'releng/autorelease'
    jdk: 'openjdk7'

- job-template:
    name: 'autorelease-daily-lithium'

    project-type: maven
    node: dynamic_verify
    jdk: '{jdk}'

    logrotate:
        daysToKeep: '{build-days-to-keep}'
        numToKeep: '{build-num-to-keep}'
        artifactDaysToKeep: '{build-artifact-days-to-keep}'
        artifactNumToKeep: '{build-artifact-num-to-keep}'

    parameters:
        - project-parameter:
            project: '{project}'
        - autorelease-release-tag:
            release-tag: 'Daily'
        - autorelease-release-branch:
            release-branch: '{branch}'
        - autorelease-release-datestamp:
            datestamp: true

    scm:
        - git:
            credentials-id: '{ssh-credentials}'
            url: '$GIT_BASE'
            refspec: ''
            branches:
                - 'origin/{branch}'
            skip-tag: true
            submodule:
                recursive: true

    wrappers:
        - autorelease-build-timeout
        - ssh-agent-credentials:
            users:
                - '{ssh-credentials}'

    triggers:
        - timed: 'H 0 * * *'

    prebuilders:
        - wipe-org-opendaylight-repo
        - autorelease-generate-taglist
        - autorelease-generate-release-patches

    maven:
        maven-name: '{mvn32}'
        root-pom: 'pom.xml'
        goals: 'clean install source:jar javadoc:jar -Pintegrationtests,docs,repoBuild -fae -Dcheckstyle.skip=true -Dmaven.repo.local=/tmp/r -Dorg.ops4j.pax.url.mvn.localRepository=/tmp/r'
        maven-opts: '-Xmx6144m -XX:MaxPermSize=1024m -Dmaven.compile.fork=true -DforkCount=1 -DreuseForks=false'
        settings: '{autorelease-settings}'
        global-settings: '{odl-global-settings}'
        automatic-archiving: false

    postbuilders:
        - shell: "./scripts/list-project-dependencies.sh"
        - autorelease-maven-sources:
            maven-version: '{mvn32}'
            settings: '{autorelease-settings}'
            global-settings: '{odl-global-settings}'
        - autorelease-maven-sources-post-process
        - jacoco-nojava-workaround

    publishers:
        - maven-deploy:
            url: 'https://nexus.opendaylight.org/content/repositories/opendaylight.daily/'
            id: 'opendaylight.daily'
            unique-version: true
            deploy-unstable: true
        - archive-artifacts:
            artifacts: '*.log,patches/*.patch'
        - email-notification:
            email-prefix: '[autorelease]'

- job-template:
    name: 'autorelease-release-lithium'

    project-type: maven
    node: dynamic_verify
    jdk: '{jdk}'

    logrotate:
        daysToKeep: '{build-days-to-keep}'
        numToKeep: '{build-num-to-keep}'
        artifactDaysToKeep: '{build-artifact-days-to-keep}'
        artifactNumToKeep: '{build-artifact-num-to-keep}'

    parameters:
        - project-parameter:
            project: '{project}'
        - autorelease-release-tag:
            release-tag: 'Pre-Lithium'
        - autorelease-release-branch:
            release-branch: '{branch}'
        - autorelease-release-datestamp:
            datestamp: false

    scm:
        - git:
            credentials-id: '{ssh-credentials}'
            url: '$GIT_BASE'
            refspec: ''
            branches:
                - 'origin/{branch}'
            skip-tag: true
            submodule:
                recursive: true

    wrappers:
        - autorelease-build-timeout
        - ssh-agent-credentials:
            users:
                - '{ssh-credentials}'

    prebuilders:
        - wipe-org-opendaylight-repo
        - autorelease-generate-taglist
        - autorelease-generate-release-patches

    maven:
        maven-name: '{mvn32}'
        root-pom: 'pom.xml'
        goals: 'clean install source:jar javadoc:jar -Pintegrationtests,docs,repoBuild -fae -Dcheckstyle.skip=true -Dmaven.repo.local=/tmp/r -Dorg.ops4j.pax.url.mvn.localRepository=/tmp/r'
        maven-opts: '-Xmx6144m -XX:MaxPermSize=1024m -Dmaven.compile.fork=true -DforkCount=1 -DreuseForks=false'
        settings: '{autorelease-settings}'
        global-settings: '{odl-global-settings}'
        automatic-archiving: false

    postbuilders:
        - autorelease-cfp:
            autorelease-settings: '{autorelease-settings}'
            odl-global-settings: '{odl-global-settings}'
        - autorelease-maven-deploy
        - shell: "./scripts/list-project-dependencies.sh"
        - autorelease-maven-sources:
            maven-version: '{mvn32}'
            settings: '{autorelease-settings}'
            global-settings: '{odl-global-settings}'
        - autorelease-maven-sources-post-process
        - jacoco-nojava-workaround

    publishers:
        - archive-artifacts:
            artifacts: '*.log,patches/*.patch'
        - email-notification:
            email-prefix: '[autorelease]'
